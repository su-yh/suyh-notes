<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
      "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jt.sys.dao.SysMenuDao">
	<select id="findObjects" resultType="map">
		Select m.*,
		(select p.name from sys_menus p where p.id = m.parentId) as
		parentName
		from sys_menus m
	</select>
	
	<select id="findObject" resultType="sysMenu">
		select m.*, p.name as parentName 
		from sys_menus m, sys_menus p 
		where m.id = #{id} and (m.parentId = p.id or m.parentId is null);
	</select>
	
	<delete id="deleteMenu">
		delete from sys_menus where id = #{id}
	</delete>
	
	<!-- 查询指定ID 下有子菜单的个数 -->
	<select id="findChildNumber" resultType="int">
		select count(parentId) from sys_menus 
			where parentId = #{parentId}
	</select>
	
	<select id="findZtreeNodes" resultType="node">
		select id, parentId, name from sys_menus
	</select>
	
	<insert id="insertObject">
		insert into sys_menus(id, name, url, type, sort, note, parentId, 
			permission, createdTime, modifiedTime, createdUser, modifiedUser)
		values(null, #{name}, #{url}, #{type}, #{sort}, #{note}, #{parentId},
			#{permission}, now(), now(), #{createdUser}, #{modifiedUser})
	</insert>
	
	<update id="updateObject">
		update sys_menus 
		<set>
			<if test="name != null">
				name = #{name},
			</if>
			<if test="url != null">
				url = #{url}, 
			</if>
			<if test="type != null">
				type = #{type}, 
			</if>
			<if test="sort != null">
				sort = #{sort}, 
			</if>
			<if test="note != null">
				note = #{note},
			</if>
			<if test="parentId != null">
				parentId = #{parentId},
			</if>
			<if test="permission != null">
				permission = #{permission},
			</if>
			modifiedTime = now()
		</set>
		where id = #{id};
	</update>
</mapper>

